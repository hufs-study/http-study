# 6장 프락시

## 6.1 웹 중개자

> 웹 프락시 서버란, 클라이언트 입장에서 트랜잭션을 수행하는 중개인

<div align="center">
    <img src="./img/1.PNG" alt="" />
</div>

### 6.1.1 개인 프락시와 공유 프락시

> 개인 프락시란, 하나의 클라이언트만을 위한 프락시  
> 공용 프락시란, 여러 클라이언트가 함께 사용하는 프락시

| 공용 프락시                                                                         | 개인 프락시                               |
|:-------------------------------------------------------------------------------|:-------------------------------------|
| 대부분의 프락시는 공용이며 공유된 프락시                                                         | 클라이언트에서 직접 실행되는 형태로 종종 사용            |
| <br/>프락시를 사용하는 사용자가 많을수록 유리  <br/> 여러 사용자들의 공통된 요청에서의 이점 때문 <br/>ex) 캐시 프락시 서버 | 브라우저 기능 확장 및 성능 개선, 무료 ISP 서비스 광고 목적 |

### 6.1.2 프락시 대 게이트웨이

> 프락시 &rarr; `같은 프로토콜`을 사용하는 둘 이상의 애플리케이션 연결  
> 게이트웨이 &rarr; `서로 다른 프로토콜`을 사용하는 둘 이상의 애플리케이션 연결

<div align="center">
    <img src="./img/2.PNG" alt="" />
</div>

## 6.2 왜 프락시를 사용하는가?

- 프락시 사용 예시

|                           어린이 필터                           |                         문서 접근 제어자                          |  
|:----------------------------------------------------------:|:----------------------------------------------------------:|
| <div align="center"><img src="./img/3.PNG" alt="" /></div> | <div align="center"><img src="./img/4.PNG" alt="" /></div> | 

|                           보안 방화벽                            |                            웹 캐시                            |
|:-----------------------------------------------------------:|:----------------------------------------------------------:|
| <div align="center"><img src="./img/5.PNG" alt="" /></div>  | <div align="center"><img src="./img/6.PNG" alt="" /></div> |

|                           대리 프락시                           |                          콘텐츠 라우터                           |
|:----------------------------------------------------------:|:----------------------------------------------------------:|
| <div align="center"><img src="./img/7.PNG" alt="" /></div> | <div align="center"><img src="./img/8.PNG" alt="" /></div> |

|                           트랜스코더                            |                          콘텐츠 라우터                           |
|:----------------------------------------------------------:|:----------------------------------------------------------:|
| <div align="center"><img src="./img/7.PNG" alt="" /></div> | <div align="center"><img src="./img/8.PNG" alt="" /></div> |

|                         콘텐츠 트랜스코더                          |                           익명화 프락시                           |
|:----------------------------------------------------------:|:-----------------------------------------------------------:|
| <div align="center"><img src="./img/9.PNG" alt="" /></div> | <div align="center"><img src="./img/10.PNG" alt="" /></div> |

## 6.3 프락시는 어디에 있는가?

### 6.3.1 프락시 서버 배치

<div align="center">
    <img src="./img/11.PNG" alt=""/>
</div>

**출구 프락시**
> 로컬 네트워크와 인터넷 사이의 트랜잭션을 제어하기 위한 프락시

**접근 프락시**
> 사용자 다운로드 속도를 개선하고 인터넷 대역폭 비용을 줄이기 위해 캐시 프락시로 사용

**대리 프락시(= 리버스 프락시)**
> 웹 서버로 향하는 모든 요청을 처리하고 필요할 때만 웹 서버에 자원 요청  
> 일반적으로 웹 서버의 이름과 IP 주소로 가려 모든 요청은 서버가 아닌 프락시로 향함

**네트워크 교환 프락시**
> 트래픽 분산을 위해 분산 처리 능력을 갖춘 프락시

### 6.3.2 프락시 계층

프락시 계층 내에서 다음과 같은 근거로 프락시 서버를 선택하게 된다.

| 근거                   | 설명                                    |
|:---------------------|:--------------------------------------|
| **부하 균형**            | 부하를 분산하기 위해 다른 프락시 서버 트래픽을 고려하여 선택    |
| **지리적 인접성에 근거한 라우팅** | 원 서버의 지역을 담당하는 프락시 선택                 |
| **프로토콜/타입 라우팅**      | URI에 근거하여 라우팅                         |
| **특정 사용자를 위한 라우팅**   | 빠른 서비스를 원하는 사용자를 위해 캐시나 성능 개선을 위해 라우팅 |

### 6.3.3 어떻게 프락시가 트래픽을 처리하는가

클라이언트가 프락시 서버로 트래픽을 위임하는 4가지 방법

<div align="center">
    <img src="./img/12.PNG" alt="" />
</div>

|항목|설명|
|:-----|:-----|
|(a) 클라이언트 수정|클라이언트는 HTTP 요청을 바로 프락시로 전송|
|(b) 네트워크 수정|클라이언트가 보낸 HTTP 요청을 클라이언트 모르게 프락시 서버가 가로챈다 &rarr; 인터셉트 프락시|
|(c) DNS name space 수정|웹 서버 앞에 위치하는 프락시 서버는 웹 서버의 이름과 IP 주소를 자신이 직접 사용하여 클라이언트에서 보낸 HTTP 요청은 프락시로 향함|
|(d) 웹 서버 수정|웹 서버가 305를 클라이언트에게 반환하여 프락시로 리다이렉트 시킴|

## 6.4 클라이언트 프락시 설정

### 6.4.2 클라이언트 프락시 설정: PAC 파일

**PAC(= Proxy Auto-Config)란**
> 별도의 프록시 서버 설정 없이 특정 URL에 대해 자동으로 프록시 설정을 해주는 스크립트

리소스 접근시마다 클라이언트가 `PAC` 스크립트를 통해 적절한 프락시 서버 선택


- `PAC` 스크립트 예시
```js
function FindProxyForURL(url, host) { 
    if (url.substring(0,5) = "http:") {
        return "PROXY http-proxy.mydomain.com:8080";
    } else if (url.substring(0,4) = "ftp:") {
        return "PROXY ftp-proxy.mydomain.com:8080";
    } else {
        return "DIRECT";
    }
}
```

### 6.4.3 클라이언트 프락시 설정: WPAD

**WPAD(= Web Proxy Auto Discovery Protocol)이란**
> 브라우저에 알맞은 `PAC` 파일을 자동으로 찾아주는 알고리즘

- `WPAD`이 구현된 **클라이언트가 HTTP 요청 처리**하는 방식
```text
1. PAC URI를 찾기 위해 WPAD 사용
2. 주어진 URI에서 PAC 파일 조회
3. 프락시 서버를 알아내기 위해 PAC 파일 실행
4. 알아낸 프락시 서버를 이용해 요청 처리
```

- `WPAD`가 **올바른 `PAC` 파일을 찾기 위한 명세** 기법
```text
- 동적 호스트 발견 규약(= DHCP)
- 서비스 위치 교육(= SLP)
- DNS 잘 알려진 호스트 명
- DNS SRV 레코드
- DNS TXT 레코드 안의 서비스 URI
```

## 6.5 프락시 요청의 미묘한 특징들

### 6.5.1 프락시 URI는 서버의 URI와 다르다

|                        클라이언트 &rarr; 웹 서버                        |                                       클라이언트 &rarr; 프락시                                        |
|:---------------------------------------------------------------:|:---------------------------------------------------------------------------------------------:|
| ```GET /index.html HTTP/1.0<br/>User-Agent: SuperBrowservl.3``` | ```GET http://www.marys-antiques.com/index.html HTTP/1.0<br/>User-Agent: SuperBrowser vl.3``` |
|                     without 스킴, 호스트, 포트 번호                      |                                          완전한 URI 형태                                           |

> 기존 HTTP 설계는 클라이언트 &harr; 서버로 불필요한 정보 전송 방지를 위해 `스킴`, `호스트`가 없는 URI 전송  
> 프락시가 부상하면서 프락시 &harr; 서버 connection을 맺어야 하기 때문에 서버 정보를 알 필요가 있어 완전한 URI 전송